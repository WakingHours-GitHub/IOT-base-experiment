C51 COMPILER V9.57.0.0   MAIN                                                              05/10/2022 15:01:48 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\KEIL\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg51.h>
   2          
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          #define write_ADD 0xa0 // Ð´ÈëµÄµØÖ·
   6          #define read_ADD 0xa1 // ¶ÁÈ¡µÄµØÖ·
   7          
   8          
   9          
  10          void SomeNop();     //¶ÌÑÓÊ±
  11          void init();    //³õÊ¼»¯
  12          void check_ACK(void);
  13          void I2CStart(void);
  14          void I2cStop(void);
  15          void write_byte(uchar dat);//Ð´×Ö½Ú
  16          void delay();
  17          uchar read_byte();     //¶Á×Ö½Ú
  18          uchar read_add(uchar address);
  19          void write_add(uchar address,uchar date);
  20          uchar read(uchar addr);       //Ö¸¶¨µØÖ·¶Á
  21          
  22          sbit sda=P1^0;
  23          sbit scl=P1^1;
  24          
  25          uchar a;  
  26          
  27          bit flag;  //Ó¦´ð±êÖ¾Î»
  28          
  29          
  30          void main(){
  31   1          init();
  32   1          write_add(0x10,0x00); //ÏòµØÖ·5Ð´Èë0xaa
  33   1          delay(); // ÑÓÊ±, ÐèÒªµÈ´ýÊý¾ÝµÄÐ´Èë
  34   1          P1=read_add(0x10);      //¶ÁÈ¡µØÖ·5µÄÖµ
  35   1          while(1); // Ô­µØµÈ´ý
  36   1      }
  37           
  38           
  39           
  40          void delay(){
  41   1        ; ;
  42   1      }
  43          
  44          //¿ªÊ¼ÐÅºÅ SCLÔÚ¸ßµçÆ½ÆÚ¼ä£¬SDAÒ»¸öÏÂ½µÑØÔò±íÊ¾Æô¶¯ÐÅºÅ 
  45          void start() {     
  46   1          sda=1; //ÊÍ·ÅSDA×ÜÏß  
  47   1          delay();  
  48   1          scl=1;  
  49   1          delay();  
  50   1          sda=0;  
  51   1          delay();  
  52   1      }  
  53          
  54          //Í£Ö¹ SCLÔÚ¸ßµçÆ½ÆÚ¼ä£¬SDAÒ»¸öÉÏÉýÑØÔò±íÊ¾Í£Ö¹ÐÅºÅ  
C51 COMPILER V9.57.0.0   MAIN                                                              05/10/2022 15:01:48 PAGE 2   

  55          void stop() {  
  56   1          sda=0;  
  57   1          delay();  
  58   1          scl=1;  
  59   1          delay();  
  60   1          sda=1;  
  61   1          delay();  
  62   1      }
  63          
  64           //Ó¦´ð SCLÔÚ¸ßµçÆ½ÆÚ¼ä£¬SDA±»´ÓÉè±¸À­ÎªµÍµçÆ½±íÊ¾Ó¦´ð  
  65          void respons() {
  66   1          uchar i;  
  67   1          scl=1;  
  68   1          delay(); 
  69   1          //ÖÁ¶àµÈ´ý250¸öCPUÊ±ÖÓÖÜÆÚ 
  70   1          while((sda==1)&&(i<250))i++;  
  71   1          scl=0;  
  72   1          delay();  
  73   1      }  
  74          
  75          //×ÜÏß³õÊ¼»¯ ½«×ÜÏß¶¼À­¸ßÒ»ÊÍ·Å×ÜÏß  ·¢ËÍÆô¶¯ÐÅºÅÇ°£¬ÒªÏÈ³õÊ¼»¯×ÜÏß¡£¼´×ÜÓÐ¼ì²âµ½×ÜÏß¿ÕÏÐ²Å¿ªÊ¼·¢ËÍÆô¶¯ÐÅº
             -Å  
  76          void init(){  
  77   1          sda=1;  
  78   1          delay();  
  79   1          scl=1;  
  80   1          delay();  
  81   1      }  
  82            
  83          void write_byte(uchar date){
  84   1          uchar i,temp;  
  85   1          temp=date;  
  86   1        
  87   1        
  88   1          for(i=0;i<8;i++)  {  
  89   2              temp=temp<<1;  // ×óÒÆ
  90   2              scl=0;//À­µÍSCL£¬ÒòÎªÖ»ÓÐÔÚÊ±ÖÓÐÅºÅÎªµÍµçÆ½ÆÚ¼ä°´Êý¾ÝÏßÉÏµÄ¸ßµÍµçÆ½×´Ì¬²ÅÔÊÐí±ä»¯£»²¢ÔÚ´ËÊ±ºÍÉÏÒ»¸
             -öÑ­»·µÄscl=1Ò»ÆðÐÎ³ÉÒ»¸öÉÏÉýÑØ  
  91   2              delay();  
  92   2              sda=CY;  
  93   2              delay();  
  94   2              scl=1;//À­¸ßSCL£¬´ËÊ±SDAÉÏµÄÊý¾ÝÎÈ¶¨  
  95   2              delay();  
  96   2          }  
  97   1          scl=0;//À­µÍSCL£¬ÎªÏÂ´ÎÊý¾Ý´«Êä×öºÃ×¼±¸  
  98   1          delay();  
  99   1          sda=1;//ÊÍ·ÅSDA×ÜÏß£¬½ÓÏÂÀ´ÓÉ´ÓÉè±¸¿ØÖÆ£¬±ÈÈç´ÓÉè±¸½ÓÊÕÍêÊý¾Ýºó£¬ÔÚSCLÎª¸ßÊ±£¬À­µÍSDA×÷ÎªÓ¦´ðÐÅºÅ  
 100   1          delay();  
 101   1      }  
 102          
 103          //¶ÁÒ»¸ö×Ö½Ú 
 104          uchar read_byte() {  
 105   1          uchar i,k;  
 106   1          scl=0;  
 107   1          delay();  
 108   1          sda=1;  
 109   1          delay();  
 110   1          for(i=0;i<8;i++)  
 111   1          {  
 112   2              scl=1;//ÉÏÉýÑØÊ±£¬IICÉè±¸½«Êý¾Ý·ÅÔÚsdaÏßÉÏ£¬²¢ÔÚ¸ßµçÆ½ÆÚ¼äÊý¾ÝÒÑ¾­ÎÈ¶¨£¬¿ÉÒÔ½ÓÊÕÀ²  
 113   2              delay();      
 114   2              k=(k<<1)|sda;  
C51 COMPILER V9.57.0.0   MAIN                                                              05/10/2022 15:01:48 PAGE 3   

 115   2              scl=0;//À­µÍSCL£¬Ê¹·¢ËÍ¶Ë¿ÉÒÔ°ÑÊý¾Ý·ÅÔÚSDAÉÏ  
 116   2              delay();      
 117   2          }  
 118   1          return k;  
 119   1      }  
 120          
 121          //ÈÎÒâµØÖ·Ð´Ò»¸ö×Ö½Ú  
 122          void write_add(uchar address,uchar date){  
 123   1          start();//Æô¶¯  
 124   1          write_byte(0xa0);//·¢ËÍ´ÓÉè±¸µØÖ·  
 125   1          respons();//µÈ´ý´ÓÉè±¸µÄÏìÓ¦  
 126   1          write_byte(address);//·¢³öÐ¾Æ¬ÄÚµØÖ·  
 127   1          respons();//µÈ´ý´ÓÉè±¸µÄÏìÓ¦  
 128   1          write_byte(date);//·¢ËÍÊý¾Ý  
 129   1          respons();//µÈ´ý´ÓÉè±¸µÄÏìÓ¦  
 130   1          stop();//Í£Ö¹  
 131   1      }  
 132          //¶ÁÈ¡Ò»¸ö×Ö½Ú  
 133          uchar read_add(uchar address){  
 134   1          uchar date;  
 135   1          start();//Æô¶¯  
 136   1          write_byte(0xa0);//·¢ËÍ·¢ËÍ´ÓÉè±¸µØÖ· Ð´²Ù×÷  
 137   1          respons();//µÈ´ý´ÓÉè±¸µÄÏìÓ¦  
 138   1          write_byte(address);//·¢ËÍÐ¾Æ¬ÄÚµØÖ·  
 139   1          respons();//µÈ´ý´ÓÉè±¸µÄÏìÓ¦  
 140   1          start();//Æô¶¯  
 141   1          write_byte(0xa1);//·¢ËÍ·¢ËÍ´ÓÉè±¸µØÖ· ¶Á²Ù×÷  
 142   1          respons();//µÈ´ý´ÓÉè±¸µÄÏìÓ¦  
 143   1          date=read_byte();//»ñÈ¡Êý¾Ý  
 144   1          stop();//Í£Ö¹  
 145   1          return date;//·µ»ØÊý¾Ý  
 146   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    211    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
